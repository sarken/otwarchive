<h3 class="landmark heading"><%= ts("Navigation and Actions") %></h3>
<div class="actions module" id="work-header-navigation">
  <ul class="navigation actions" role="menu">
    <% # BEGIN owner actions: add chapter, edit work, edit tags, delete work %>
    <% if is_author_of?(@work) %>
      <li>
        <h4 class="heading"><%= ts("Manage") %></h4>
        <ul class="menu">
          <li><%= link_to ts("Add Chapter"), new_work_chapter_path(@work) %></li>
          <li><%= link_to ts("Edit Work"), edit_work_path(@work) %></li>
          <li><%= link_to ts("Edit Tags"), edit_tags_work_path(@work) %></li>
          <li><%= link_to ts("Delete Work"), confirm_delete_work_path(@work) %></li>
        </ul>
      </li>
    <% end %>
    <% # END owner actions%>
  
    <% # BEGIN display options: entire work or chapter by chapter, show or hide work skin %>
    <% if @chapters ||  @work.work_skin %>
      <li>
        <h4 class="heading"><%= ts("Display") %></h4>
        <ul class="menu">
          <% if @previous_chapter || @next_chapter %>
            <li><%= link_to ts("Entire Work"), work_path(@work, :view_full_work => 'true') %></li>
          <% elsif @chapters %>
            <li><%= link_to ts("Chapter by Chapter"), [@work, @chapter] %></li>
          <% end %>
          <% if @work.work_skin %>
            <li>
              <% if Preference.disable_work_skin?(params[:style]) %>
                <%= link_to(ts("Show Creator's Style"), params[:view_full_work] == 'true' ? url_for(:style => 'creator', :view_full_work => 'true') : url_for(:style => 'creator')) %>
              <% else %>
                <%= link_to(ts("Hide Creator's Style"), params[:view_full_work] == 'true' ? url_for(:style => 'disable', :view_full_work => 'true') : url_for(:style => 'disable')) %>
              <% end %>
            </li>
          <% end %>
        </ul>
      </li>
    <% end %>
    <% # END display options %>

    <li>
      <h4 class="heading"><%= ts("Download") %></h4>
      <ul class="menu">
        <li><%= link_to ts("MOBI"), download_url_for_work(@work, "mobi") %></li>
        <li><%= link_to ts("EPUB"), download_url_for_work(@work, "epub") %></li>
        <li><%= link_to ts("PDF"), download_url_for_work(@work, "pdf") %></li>
        <li><%= link_to ts("HTML"), download_url_for_work(@work, "html") %></li>
      </ul>
    </li>

    <% # BEGIN tracking options: bookmark, mark for later, and subscribe %>
    <% if current_user.is_a?(User) %>
      <% @bookmark ||= bookmark_if_exists(@work) %>
      <li>
        <%= link_to (@bookmark ? ts("Edit Bookmark") : ts("Bookmark")), "#bookmark-form", :class => "bookmark_form_placement_open" %>
        <%= link_to ts("Cancel Bookmark"), "#", :class => "bookmark_form_placement_close hidden" %>
      </li>

      <% unless current_user.is_author_of?(@work) || current_user.try(:preference).try(:history_enabled) == false || marked_for_later?(@work) %>
        <li><%= marktoread_link(@work) %></li>
      <% end %>
    
      <% if @subscription %>
        <li class="subscribe">
          <%= render 'subscriptions/form', :subscription => @subscription %>
        </li>
      <% end %>
    <% end %>
    <% # END tracking options %>

    <li class="share hidden">
      <%= link_to_modal ts("Share"), :for => "#share", :title => ts("Share Work") %>
      <% # render 'share/share', :shareable => @work %>
    </li>

    <li><%= link_to ts("Comments"), (params[:view_full_work] == 'true' ? work_path(@work, :view_full_work => 'true', :show_comments => true, :anchor => 'comments') : url_for(:show_comments => true, :anchor => 'comments')) %></li>
  </ul>

  <% # BEGIN chapter navigation for chapter by chapter view: previous chapter, chapter index, next chapter %>
  <% if @previous_chapter || @next_chapter %>
    <h4 class="landmark heading"><%= ts("Chapter Navigation") %></h4>
    <ul class="chapter navigation actions" role="menu">
      <li class="previous">
        <% if @previous_chapter %>
          <%= link_to '&#8592; '.html_safe + ts("Previous"), [@work, @previous_chapter] %>
        <% else %>
          <span class="disabled">&#8592; <%= ts("Previous") %></span>
        <% end %>
      </li>
    
      <li>
        <%= link_to ts('Chapter Index'), navigate_work_path(@work) %>
        <ul class="hidden menu">
          <% for chapter in @chapters %>
            <li><%= link_to chapter.display_title.html_safe, [chapter.work, chapter] %></li>
          <% end %>
          <li><%= link_to ts("Full-Page Index"), navigate_work_path(@work) %></li>
        </ul>
      </li>        
      <li class="next">
        <% if @next_chapter %>
          <%= link_to h(ts("Next")) + ' &#8594;'.html_safe, [@work, @next_chapter] %>
        <% else %>
          <span class="disabled"><%= ts("Next") %> &#8594;</span>        
        <% end %>
      </li>
    </ul>
  <% end %>
  <% # END chapter navigation %>
</div>

<%= content_for :footer_js do %>
  <%= javascript_tag do %>
  $j(document).ready(function() {
    var menu = $j('#work-header-navigation').find('.menu').addClass('dropdown-menu');
    var menuName = menu.siblings();
    var menuContainer = menu.parent('li').addClass('dropdown');
     
    menuName.contents().unwrap().wrap('<a href="#"></a>');
    menuContainer.attr("aria-haspopup", true);
    menuContainer.children('a').attr({
      'class': 'dropdown-toggle',
      'data-toggle': 'dropdown',
      'data-target': '#'
    });
    menu.children('li').attr("role", "menu-item");
  });
  <% end %>
<% end %>
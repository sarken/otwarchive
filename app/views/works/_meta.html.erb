<% cache_unless(@preview_mode, "/v4/#{work.cache_key}-#{Work.work_blurb_version(work.id)}-meta-#{hide_warnings?(work) ? 'nowarn' : 'showwarn'}-#{hide_freeform?(work)  ? 'nofreeform' : 'showfreeform'}", skip_digest: true) do %>
<h3 class="landmark heading"><%= ts("Work Header") %></h3>

<div class="wrapper">

  <dl class="work meta group">
    <% tag_group = work.tag_groups
       Tag::VISIBLE.each do |type| %>
      <% tags = tag_group[type] %>
        <% unless tags.blank? %>
          <dt class="<%= tag_type_css_class(type) %> tags">
            <% if type == "ArchiveWarning" %>
              <%= link_to( tags.size == 1 ? type.constantize::NAME : type.constantize::NAME.pluralize, tos_faq_path(anchor: "tags") ) %>:
            <% elsif type.constantize::NAME == ArchiveConfig.FREEFORM_CATEGORY_NAME %>
              <%= type.constantize::NAME %>:
            <% else %>
              <%= tags.size == 1 ? type.constantize::NAME : type.constantize::NAME.pluralize %>:
            <% end %>
          </dt>

          <dd class="<%= tag_type_css_class(type) %> tags">
            <ul class="commas">
              <% if (type == "ArchiveWarning" && hide_warnings?(work)) || (type == "Freeform" && hide_freeform?(work)) %>
                <%= show_hidden_tag_link_list_item(work, type, { suppress_toggle_class: true }) %>
             <% else %>
               <%= tag_link_list(tags, link_to_works = true) %>
             <% end %>
            </ul>
          </dd>
      <% end %>
    <% end %>

    <% unless @work.language.blank? %>
      <dt class="language">
        <%= t(".language") %>
      </dt>
      <dd class="language" lang="<%= @work.language.short %>">
        <%= @work.language.name %>
      </dd>
    <% end %>

    <% unless @work.serial_works.blank? %>
      <dt class="series">
        <%= t(".series") %>
      </dt>
      <dd class="series">
        <%= show_series_data(@work) %>
      </dd>
    <% end %>

    <% unless @work.approved_collections.empty? %>
      <dt class="collections">
        <%= t(".collections") %>
      </dt>
      <dd class="collections">
        <%= show_collections_data(@work.approved_collections) %>
      </dd>
    <% end %>

    <dt class="work stats"><%= t(".stats.work") %></dt>
    <dd class="work stats">
<% end %><!-- end of cache -->

      <%= work_meta_list(@work, @chapter) %>
    </dd>

    <% if show_chapter_stats(work) %>
      <dt class="chapter stats"><%= t(".stats.chapter") %></dt>
      <dd class="chapter stats">
        <dl class="stats">
          <dt class="published"><%= t(".stats.published") %></dt>
          <dd class="published"><%= localize(@chapter.published_at) %></dd>
          <dt class="words"><%= t(".stats.words") %></dt>
          <dd class="words"><%= number_with_delimiter(@chapter.word_count) %></dd>
          <% unless @chapter.count_visible_comments.zero? %>
            <dt class="comments"><%= t(".stats.comments") %></dt>
            <dd class="comments"><%= number_with_delimiter(@chapter.count_visible_comments) %></dd>
          <% end %>
        </dl>
      </dd>
    <% end %>

    <% if policy(:user_creation).show_original_creators? %>
      <% if @work.original_creators.any? %>
        <% original_creators = @work.original_creators.map(&:display) %>
        <dt class="creators">
          <%= t(".original_creators", count: original_creators.count) %>
        </dt>
        <dd class="creators">
          <%= original_creators.join(", ") %>
        </dd>
      <% end %>
    <% end %>

    <% if policy(:user_creation).show_ip_address? %>
      <dt class="ip">
        <%= t(".ip.label") %>
      </dt>
      <dd class="ip">
        <% if @work.ip_address.nil? %>
          <%= t(".ip.data.none") %>
        <% else %>
          <%= @work.ip_address %>
        <% end %>
      </dd>
    <% end %>

    <% if logged_in_as_admin? %>
      <dt class="akismet">
        <%= t(".spam.label") %>
      </dt>
      <dd class="akismet">
        <% if !@work.spam_checked? %>
          <%= t(".spam.data.none") %>
        <% else %>
          <%= @work.spam? ? t(".spam.data.spam") : t(".spam.data.ham") %>
        <% end %>
      </dd>

      <dt class="limit">
        <%= t(".tag_limit.label") %>
      </dt>
      <dd class="limit">
        <%= @work.user_defined_tags_count > ArchiveConfig.USER_DEFINED_TAGS_MAX ? t(".tag_limit.data.over") : t(".tag_limit.data.under") %>
      </dd>

      <% if @work.gifts.are_rejected.exists? %>
        <dt class="gift">
          <%= t(".rejected_gift") %>
        </dt>
        <dd class="gift">
          <%= @work.gifts.are_rejected.map { |g| g.recipient }.join(", ") %>
        </dd>
      <% end %>
    <% end %>
  </dl>
</div>
